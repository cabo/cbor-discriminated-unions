<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>CBOR Tags for Discriminated Unions</title>
<meta content="Duncan Coutts" name="author">
<meta content="Michael Peyton Jones" name="author">
<meta content="Carsten Bormann" name="author">
<meta content="
       The Concise Binary Object Representation (CBOR, RFC 8949) is a data
format whose design goals include the possibility of extremely small
code size, fairly small message size, and extensibility without the
need for version negotiation. 
       In programming, there is often a need to define types that are
composed of enumerated alternatives.  While CBOR has no problem
representing types that are unions of other types, this may not make
visible which of the enumerated alternatives was chosen, in particular if
multiple alternatives overlap in their CBOR representations.
In other words, CBOR has no direct support for discriminated unions. 
       In CBOR, one point of extensibility is the definition of CBOR tags.
In protocol development, it is possible to register different tags
for each alternative, but this would be difficult to automate in the
course of using CBOR for normal program development, it might use up
registration resources and tag numbers, and would create an unwelcome
threshold for using CBOR in these activities. 
       Instead, the alternatives could simply be numbered by a program compiler.
The present document defines tags for such a use in discriminated unions,
i.e., where there is no intention to register application-specific
tags for each of the branches in the union. 
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-bormann-cbor-discriminated-unions-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.8.5
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.0.2
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.5.0
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.3.1
    requests 2.22.0
    setuptools 45.2.0
    six 1.14.0
-->
<link href="draft-bormann-cbor-discriminated-unions.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: #bbb;
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>

</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CBOR Tags for Discriminated Unions</td>
<td class="right">January 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Coutts, et al.</td>
<td class="center">Expires 22 July 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-bormann-cbor-discriminated-unions-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-01-18" class="published">18 January 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-07-22">22 July 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Coutts</div>
</div>
<div class="author">
      <div class="author-name">M.P. Jones</div>
</div>
<div class="author">
      <div class="author-name">C. Bormann, <span class="editor">Ed.</span>
</div>
<div class="org">Universität Bremen TZI</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">CBOR Tags for Discriminated Unions</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Concise Binary Object Representation (CBOR, RFC 8949) is a data
format whose design goals include the possibility of extremely small
code size, fairly small message size, and extensibility without the
need for version negotiation.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">In programming, there is often a need to define types that are
composed of enumerated alternatives.  While CBOR has no problem
representing types that are unions of other types, this may not make
visible which of the enumerated alternatives was chosen, in particular if
multiple alternatives overlap in their CBOR representations.
In other words, CBOR has no direct support for discriminated unions.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">In CBOR, one point of extensibility is the definition of CBOR tags.
In protocol development, it is possible to register different tags
for each alternative, but this would be difficult to automate in the
course of using CBOR for normal program development, it might use up
registration resources and tag numbers, and would create an unwelcome
threshold for using CBOR in these activities.<a href="#section-abstract-3" class="pilcrow">¶</a></p>
<p id="section-abstract-4">Instead, the alternatives could simply be numbered by a program compiler.
The present document defines tags for such a use in discriminated unions,
i.e., where there is no intention to register application-specific
tags for each of the branches in the union.<a href="#section-abstract-4" class="pilcrow">¶</a></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-note-to-readers">
<a href="#name-note-to-readers" class="section-name selfRef">Note to Readers</a>
      </h2>
<p id="section-note.1-1">This is an individual submission to the CBOR working group of the
IETF, <a href="https://datatracker.ietf.org/wg/cbor/about/">https://datatracker.ietf.org/wg/cbor/about/</a>.
Discussion currently takes places on the github repository
<a href="https://github.com/cabo/cbor-discriminated-unions">https://github.com/cabo/cbor-discriminated-unions</a>.
If the CBOR WG believes this is a useful document, discussion is
likely to move to the CBOR WG mailing list and a github repository at
the CBOR WG github organization, <a href="https://github.com/cbor-wg">https://github.com/cbor-wg</a>.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 22 July 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-semantics" class="xref">Semantics</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="xref">3</a>.  <a href="#name-deterministically-encoded-c" class="xref">Deterministically Encoded CBOR</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-rationale" class="xref">Rationale</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-examples" class="xref">Examples</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Concise Binary Object Representation (CBOR <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>) is a data
format whose design goals include the possibility of extremely small
code size, fairly small message size, and extensibility without the
need for version negotiation.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In programming, there is often a need to define types that are
composed of enumerated alternatives.  While CBOR has no problem
representing types that are unions of other types, this may not make
visible which of the enumerated alternatives was chosen, in particular if
multiple alternatives overlap in their CBOR representations.
In other words, CBOR has no direct support for discriminated unions.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In CBOR, one point of extensibility is the definition of CBOR tags.
In protocol development, it is possible to register different tags
for each alternative, but this would be difficult to automate in the
course of using CBOR for normal program development, it might use up
registration resources and tag numbers, and would create an unwelcome
threshold for using CBOR in these activities.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Instead, the alternatives could simply be numbered by a program compiler.
The present document defines tags for such a use in discriminated unions,
i.e., where there is no intention to register application-specific
tags for each of the branches in the union.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Each of the tags specified in this document associates an unsigned
number with the enclosed data item, with the intention that this
number identifies one of a set of enumerated alternatives that could
have been chosen at this position in the CBOR data item.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">For example data representing the result of some action might be either
a failure with some failure detail, or a success with some result. In
this example there are two cases, the failure case and the success case,
and they can be enumerated as 0 and 1.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">In general the number of alternatives, and what data is expected in each
alternative case, are entirely application dependent.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">The tags defined in this specification allow the encoding of any number
of alternatives, but provide compact encoding for the common cases of
low numbers of alternatives:<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">Alternatives 0..6 can be encoded with two additional bytes:<a href="#section-1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-10.1">Tag number 185..191 (1+1 encoding)<a href="#section-1-10.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-10.2">tag content: the alternative<a href="#section-1-10.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-11">Alternatives 7..127 can be encoded with three additional bytes:<a href="#section-1-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-12.1">Tag number 1927..2047 (1+2 encoding)<a href="#section-1-12.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-12.2">tag content: the alternative<a href="#section-1-12.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-13">Alternatives 128+ can be encoded with 5-12 additional bytes:<a href="#section-1-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-14.1">Tag number 184 (1+1 encoding)<a href="#section-1-14.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-14.2">
          <p id="section-1-14.2.1">tag content: array (1+0 encoding), with the two elements:<a href="#section-1-14.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-14.2.2.1">alternative number (<code>uint</code>, 1+1 to 1+8 encoding) and<a href="#section-1-14.2.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1-14.2.2.2">data item: the alternative<a href="#section-1-14.2.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
      </ul>
<p id="section-1-15">(The third representation can also be used for alternatives 0 to 127;
see below.)<a href="#section-1-15" class="pilcrow">¶</a></p>
</section>
</div>
<div id="semantics">
<section id="section-2">
      <h2 id="name-semantics">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-semantics" class="section-name selfRef">Semantics</a>
      </h2>
<p id="section-2-1">Abstractly speaking, the value to be represented by these tags
consists of a case number and a case body.  The case number is
an unsigned integer that indicates which case out of the set of
alternatives is used. The case body is any CBOR data value.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">In a setting where the application uses a schema (formally or
informally), then there will be an appropriate sub-schema for each case
in the set of alternatives. The representation of the case body should
comply with the schema corresponding to the case number used.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">To continue the example above about representing failure or success,
suppose that the failure detail consists of an integer code and a
string, and suppose that the successful result is a byte string. A
failure value will use case 0 and the case body will be a list (CBOR array)
containing an integer and a text string. Alternatively, a success value
will use case 1 and the body will be a single CBOR byte string.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Decoders that enforce a schema must check the case number is within the
range of cases allowed, and that the case body follows the schema for
the supplied case number. Generic decoders should allow any case number
and any CBOR data value for the case body.<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deterministically-encoded-cbor">
<section id="section-3">
      <h2 id="name-deterministically-encoded-c">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-deterministically-encoded-c" class="section-name selfRef">Deterministically Encoded CBOR</a>
      </h2>
<p id="section-3-1">The tag 184 encoding overlaps with the more compact special encodings
for 0..6 and 7..127.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">For applications that need deterministically encoded CBOR (<span><a href="https://tools.ietf.org/html/rfc8949#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC8949" class="xref">RFC8949</a>]</span>) the following convention must be used: alternatives
in the range 0..127 must be encoded using the special compact
encoding, and must not use the tag 184 encoding. This follows the
general deterministic CBOR encoding convention of using the most
compact form.<a href="#section-3-2" class="pilcrow">¶</a></p>
<aside id="section-3-3">
        <span class="break"></span><dl class="dlParallel" id="section-3-3.1">
          <dt id="section-3-3.1.1">
Issue:    </dt>
          <dd style="margin-left: 1.5em" id="section-3-3.1.2">
            <p id="section-3-3.1.2.1">Alternatively, tag 184 could encode the alternative number
minus 128.  This would get some mileage out of the efficient
encoding of unsigned integers 0..23 for the alternative numbers 128
to 151; these cases would be represented in 4 additional bytes.
More importantly, it would also get rid of the deterministic
encoding considerations.  (I'm not suggesting encoding the
alternative number minus 152, which would use the efficiency of both
the negative and unsigned one-byte integers, or, worse, some zigzag
encoding...)<a href="#section-3-3.1.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</aside>
</section>
</div>
<div id="rationale">
<section id="section-4">
      <h2 id="name-rationale">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-rationale" class="section-name selfRef">Rationale</a>
      </h2>
<p id="section-4-1">CBOR has direct support for <em>combinations</em> of multiple values but not
for <em>alternatives</em>, i.e. one of identified multiple values. Combinations are
expressed in CBOR using lists (arrays) or maps.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Most programming languages have a notion of data consisting of
combinations of data values, often called records or objects.  Many
programming languages also have a notion of data consisting of
multiple alternative data values.  For example C has unions (the
alternative in use is not identified, though), and other languages
have "tagged" or "discriminated" unions (where it is always clear
which alternative is in use).<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Crucially for this specification, the set of alternatives must be closed
and ordered. This allows encoding using a natural number to distinguish
each case.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Note that this does <em>not</em> correspond to the notion in some programming
languages of classes and sub-classes since in that context the set of
alternatives is open and unordered. Alternatives of this kind can be
supported by other means, such as tag 27 "Serialised
language-independent object with type name and constructor arguments" <span>[<a href="#IANA.cbor-tags" class="xref">IANA.cbor-tags</a>]</span>.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">In functional programming languages, the primary way of forming new data
types is to enumerate a set of alternatives (each of which may be a
record). Such forms of data are also supported in hybrid functional
languages or languages with functional features.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">Thus in some applications, it is very common to have data making use of
alternatives, and it is worth finding a compact encoding, at least for
the common cases. Just as most records are small, most alternatives are
also small.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">In this specification we allocate 7 values in the 1+1-byte part of the
available tag encoding space for alternatives 0..6 which are by far
the most common. We allocate a range of 121 values in the 1+2-bytes
tag encoding space. To cover the general case we allocate another
1+1-byte value for a representation using a pair consisting of an
unsigned integer and the case body.<a href="#section-4-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="examples">
<section id="section-5">
      <h2 id="name-examples">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-5-1">To elaborate on the example from the introduction, we have a "result"
that is a failure or success, where:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">the failure detail consists of an integer code and a string;<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.2">the successful result is a byte string;<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-3">This corresponds to the following schema, in CDDL <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> notation:<a href="#section-5-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-cddl" id="section-5-4">
<pre>
result = 185([int, text])
         186(bytes)
</pre><a href="#section-5-4" class="pilcrow">¶</a>
</div>
<p id="section-5-5">Example values:<a href="#section-5-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-6.1">
          <code>185([3, "the printer is on fire"])</code><a href="#section-5-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-6.2">
          <code>186(h'ff00')</code><a href="#section-5-6.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-7">As a second example, here is one based on a data type defined within the
Haskell programming language, representing a simple expression tree.<a href="#section-5-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5-8">
<pre>
-- A data type representing simple arithmetic expressions:
data Expr = Lit Int -- integer literal
          | Add Expr Expr -- addition
          | Sub Expr Expr -- subtraction
          | Neg Expr -- unary negation
          | Mul Expr Expr -- multiplication
          | Div Expr Expr -- integer division
</pre><a href="#section-5-8" class="pilcrow">¶</a>
</div>
<p id="section-5-9">In CDDL notation, and using the tags in this specification, such data
could be encoded using this schema:<a href="#section-5-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-cddl" id="section-5-10">
<pre>
; A data type representing simple arithmetic expressions

expr = 185(int) ; integer literal
     / 186([expr, expr]) ; addition
     / 187([expr, expr]) ; subtraction
     / 188(expr) ; unary negation
     / 189([expr, expr]) ; multiplication
     / 190([expr, expr]) ; integer division
</pre><a href="#section-5-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">IANA is requested to allocate the following tag numbers in the CBOR
tags registry <span>[<a href="#IANA.cbor-tags" class="xref">IANA.cbor-tags</a>]</span>:<a href="#section-6-1" class="pilcrow">¶</a></p>
<span id="name-tags-to-be-registered"></span><div id="tab-tag-values">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-tags-to-be-registered" class="selfRef">Tags to be registered</a>
        </caption>
<thead>
          <tr>
            <th class="text-right" rowspan="1" colspan="1">Tag</th>
            <th class="text-left" rowspan="1" colspan="1">Data Item</th>
            <th class="text-left" rowspan="1" colspan="1">Semantics</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">184</td>
            <td class="text-left" rowspan="1" colspan="1">array of one unsigned integer and one item of any type</td>
            <td class="text-left" rowspan="1" colspan="1">numbered alternative (numbered by the uint)</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCthis]</td>
          </tr>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">185..191</td>
            <td class="text-left" rowspan="1" colspan="1">any</td>
            <td class="text-left" rowspan="1" colspan="1">numbered alternative 0..6</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCthis]</td>
          </tr>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">1927..2047</td>
            <td class="text-left" rowspan="1" colspan="1">any</td>
            <td class="text-left" rowspan="1" colspan="1">numbered alternative 7..127</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCthis]</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">TBD<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8">
      <h2 id="name-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-8.1">
        <h3 id="name-normative-references">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="IANA.cbor-tags">[IANA.cbor-tags]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Tags"</span>, <span>&lt;<a href="http://www.iana.org/assignments/cbor-tags">http://www.iana.org/assignments/cbor-tags</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor"> and P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-8.2">
        <h3 id="name-informative-references">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC8610">[RFC8610]</dt>
      <dd>
<span class="refAuthor">Birkholz, H.</span><span class="refAuthor">, Vigano, C.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Duncan Coutts</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:duncan@well-typed.com" class="email">duncan@well-typed.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Peyton Jones</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:me@michaelpj.com" class="email">me@michaelpj.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Carsten Bormann (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Universität Bremen TZI</span></div>
<div dir="auto" class="left"><span class="street-address">Postfach 330440</span></div>
<div dir="auto" class="left">
<span class="postal-code">D-28359</span> <span class="locality">Bremen</span>
</div>
<div dir="auto" class="left"><span class="country-name">Germany</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+49-421-218-63921" class="tel">+49-421-218-63921</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:cabo@tzi.org" class="email">cabo@tzi.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
